/* sc
 * Snake Charmer JS pseudo-Framework
 * @author		Tyler J Barnes
 * @contact		b4rn3scode@gmail.com
 **/
"use strict";var SnakeCharmer=function(t){this._version="1.1.2",this._config=t&&"object"==(typeof t).toLowerCase()?t:{},this._siteDomain="",this._defaultPageTitle="",this._$="undefined"==typeof jQuery?-1:jQuery,this._themeData={},this._notificationData={},this._widget=-1===this._$?"":this._$('<div id="SCWidget" class="sc_main" style="z-index:999;"></div>'),this._widgetElmsRemoved=[],this._sidebar=-1===this._$?"":this._$('<div id="SCSB" class="sc_main" style="z-index:999;"><div class="bigchat"><div id="ChatClose" class="header"><div class="name"></div><div class="time"></div><div class="close">Close</div></div><div class="primarychat"></div></div></div>'),this._displayState={widget:!1,sidebar:!1},this._defaultGetThemeUri="//zoltan.conversionvoodoo.com/include/getTheme.php",this._defaultGetNotifDataUri="//zoltan.conversionvoodoo.com/include/getNotifData.php",this._defaultEventTriggeredUri="//zoltan.conversionvoodoo.com/include/eventTriggered.php",this._defaultNotifSeenUri="//zoltan.conversionvoodoo.com/include/notifSeen.php",this._defaultBootUri="//sc.conversionvoodoo.com/include/boot.php",this._notificationSoundFile="//d61fqxuabx4t4.cloudfront.net/snakecharmer/media/notif.mp3",this._audio=null,this._eventCookieName="snevdat",this._defaultCookieExpire=10,this._notificationTimeout=2,this._dispatchedCodes=[],this._eventPool=[],this._eventQueue=[],this._queueTime=null,this._queueTimeActive=!1,this._injectScript=[],this._queuedMsgIds=[],this._notifTimer=null,this._notifTimerActive=!1,this._customEvents=0,this._identifiers={id:"#","class":".",tag:""},this._ghostMode=!1,this._plugins=[],this._loadPlugins=[],this._loadedPlugins=[],this._notificationDataCompleteEventListenerSet=!1,this._notificationDataCompleteEventName="notifdatacomplete",this._pluginLoadedEventName="pluginloadcomplete",this._pluginLoadedEvents={},this._playNotificationSound=!0,this.ini=function(){var t=window.location;if(this.installJsCss(),-1==this._$||"undefined"==typeof this._$)return this.reportDependencies(),!1;var i=["license","themeId"];for(var e in i)if(!(i[e]in this._config)){console.info("Using default configuration for Snake Charmer"),this._config=void 0;break}"undefined"==typeof this._config?this._config=this.getDefaultConfig():this._config.pageUri=this._config.pageUri&&this._config.pageUri.length>0?this._config.pageUri:t.protocol+"//"+t.hostname+t.pathname,this.boot()},this.boot=function(){var t="?license="+this._config.license+"&referrer="+encodeURIComponent(document.referrer)+"&page="+encodeURIComponent(window.location.pathname);this.addScript(document.location.protocol+this._defaultBootUri+t,!0)},this.run=function(t){t=t===!0,this._siteDomain=this.getSiteDomain(),this._loadPlugins.length>0&&this.setUpPluginLoad(),this._audio=new Audio(this._notificationSoundFile),this._defaultPageTitle=this._$("title").text(),t?(this._ghostMode&&this._$("head").append("<style>#SCWidget,#SCSB{display:none;}</style>"),this.getThemeData()):(this._ghostMode=!1,this._notificationDataCompleteEventListenerSet&&this._$(document).trigger(this._notificationDataCompleteEventName))},this.getLicense=function(){return this._config.license},this.installJsCss=function(){this._$("head").append('<link type="text/css" rel="stylesheet" href="//d61fqxuabx4t4.cloudfront.net/snakecharmer/css/sc.style.min.css"><script src="//d61fqxuabx4t4.cloudfront.net/snakecharmer/js/autosize.min.js"></script><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700" rel="stylesheet" type="text/css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">')},this.getDefaultConfig=function(){for(var t={},i=this._$("#SCJS").attr("src"),e=i.split("?")[1].split("&"),n=[],s=0;s<e.length;s++)n=e[s].split("="),"ghost"!=n[0].toLowerCase()||"true"!=n[1].toLowerCase()?t[n[0]]=n[1]:this._ghostMode=!0;return t.pageUri=window.location.protocol+"//"+window.location.hostname+window.location.pathname+window.location.search,t},this.getSiteDomain=function(){var t=window.location.host,i=t.match(/[a-z0-9\-]{1,63}\.[a-z\.]{2,10}$/g);return null!=i&&"undefined"!=typeof i&&i.length>0?i[0]:t},this.ajax=function(){var t,i,e,n,s,o=arguments,a=!1;if(o.length<2)return console.error("Invalid arguments passed to ajax function. Required: target_url, data_to_send"),!1;for(var r in o)if("object"==(typeof o[r]).toLowerCase()){for(var h in o[r]){a=!0;break}i=o[r],a||console.warn("No data passed to SnakeCharmer.ajax function [empty object]. Sending request with no data")}else"function"==(typeof o[r]).toLowerCase()?s=o[r]:"string"==(typeof o[r]).toLowerCase()&&("POST"==o[r].toUpperCase()||"GET"==o[r].toUpperCase()?e=o[r].toUpperCase():this.validUrl(o[r])&&(t=o[r]));return n=this.defaultAjaxErrCb,e=e&&null!=e&&void 0!=e&&"undefined"!=typeof e?e:"POST",s=s&&null!=s&&void 0!=s&&"undefined"!=typeof s?s:this.defaultAjaxSuccCb,this._$.ajaxSetup({cache:!1,headers:{"Cache-Control":"no-cache, no-store, must-revalidate"}}),this._$.ajax({url:t,data:i,type:e,error:n,success:function(t){s(t)}}),!0},this.getThemeData=function(){this._config.getThemeUri&&"undefined"!=typeof this._config.getThemeUri||(this._config.getThemeUri=this._defaultGetThemeUri);var t="?theme="+this._config.themeId+"&license="+this._config.license;this.addScript(document.location.protocol+this._config.getThemeUri+t,!0)},this.getNotifData=function(){this._config.getNotifDataUri&&"undefined"!=typeof this._config.getNotifDataUri||(this._config.getNotifDataUri=this._defaultGetNotifDataUri);var t="?page="+this._config.pageUri+"&license="+this._config.license,i=this.getDisplatchedCookies();i.length>0&&(t+="&dcodes="+i.join(";")),this.addScript(document.location.protocol+this._config.getNotifDataUri+t,!0)},this.addScript=function(t,i){if(t&&this.validUrl(t)){i=i===!0;var e=document.createElement("script");e.type="text/javascript",e.async=i,e.src=t;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}},this.setUpTheme=function(){var t=!1;for(var i in this._themeData){t=!0;break}if(!t)return!1;for(var e,n="",s="chatbox",o=!0,a=!0,r=0;r<this._themeData.elements.length;r++){e=this._themeData.elements[r],"img"==e.ElmTag&&(s="icon",o=!1,a=!1),this._widget.append(this._$("<div></div>").addClass(s).attr("id",s+"_"+r.toString())),n=1==e.ElmUseCloseTag?"<"+e.ElmTag+' id="'+e.ElmId+'"></'+e.ElmTag+">":"<"+e.ElmTag+' id="'+e.ElmId+'" />',this._widget.find("#"+s+"_"+r.toString()).append(n),e.ElmShowCount>0&&this._widget.find("#icon_"+r.toString()).append(this._$('<div class="notification"><small>0</small></div>')),o&&this._widget.find(e.ElmId).html(null===e.ElmInnerHtml?"":e.ElmInnerHtml),a&&this._widget.find("#chatbox_"+r.toString()).append(this._$('<div class="closer"><i class="fa fa-close"></i></div>'));for(var h=0;h<this._themeData.attributes.length;h++){var d=this._themeData.attributes[h];d.ElmRecordId==e.ElmRecordId&&this._widget.find("#"+e.ElmId).attr(d.ElmAttribute,d.ElmAttributeValue)}}return delete this._themeData.attributes,!0},this.setUpEvents=function(t){var i=!1;for(var e in this._notificationData){i=!0;break}if(!i)return!1;for(var n=0;n<this._notificationData.page_event.length;n++){var s=[],o="",a=[],r=this._notificationData.page_event[n];if(r.Queued>0)this.poolEvent(r);else if(r.HasTriggered!==!0){s=this.getEventActions(r.EID),o=s.join(", ");for(var h=0;h<this._notificationData.notifications.length;h++){this._notificationData.notifications[h].links=[];for(var d=0;d<this._notificationData.links.length;d++)this._notificationData.links[d].NID==this._notificationData.notifications[h].NID&&this._notificationData.notifications[h].links.push(this._notificationData.links[d].LinkUri);this._notificationData.notifications[h].EID==r.EID&&a.push(this._notificationData.notifications[h])}this.triggerEvent(this._identifiers[r.EIdentifier]+r.EAttrVal,o,r,a)}}return this._notificationDataCompleteEventListenerSet&&(this._$(document).trigger(this._notificationDataCompleteEventName),$(document).off(this._notificationDataCompleteEventName)),!0},this.triggerEvent=function(t,i,e,n){var s=e.EID,o=this;if("timed"==e.EType.toLowerCase()?(this.poolEvent(e),this.timeOut(e.EID,parseFloat(e.TimeOut))):"criteria"==e.EType.toLowerCase()?this.poolEvent(e):this._$(t).on(i,function(){return e.HasTriggered===!0?!1:(e.HasTriggered=!0,o.setEventCookie(s),o.eventTriggered(e)||console.warn("Failed to record triggered event [ "+s+" ]"),o.handleEventNotifData(e,n),void(o.hasInjectedJs(s)&&o.customScript(s)))}),this.manualTrigger(s)){this._dispatchedCodes.push(e.DispatchCode);for(var a=i.split(","),r=0;r<a.length;r++)if("undefined"!=typeof a[r]){var h=a[r].trim();setTimeout(function(){o._$(t).trigger(h)},1e3)}}},this.handleEventNotifData=function(t,i){for(var e=t.EID,n=this,s=!1,o=isNaN(parseInt(this._$("body").find(".notification small").text()))?0:parseInt(this._$("body").find(".notification small").text()),a=0;a<i.length;a++){if(!(i[a].NID>0&&(i[a].NBody||i[a].NMedia||i[a].NTitle)))return console.error("Invalid notification list passed to triggerEvent"),!1;i[a].EID==e&&i[a].HasSeen!==!0&&o++,s=!0}var r=this._displayState.sidebar&&s,h="";if(s&&!r){for(var d=0;d<this._widgetElmsRemoved.length;d++)this._widget.prepend(this._widgetElmsRemoved[d]);this._widgetElmsRemoved=[],h=i[0].NBody||i[0].NTitle||"View message...",h.length>40&&(h=h.substr(0,40)+"..."),this._widget.find(".chatbox span,.chatbox p, .chatbox input, .chatbox label").text(h),this._widget.find(".notification small").text(o.toString()),this._ghostMode===!1&&this._$("title").text("("+o.toString()+") "+this._defaultPageTitle)}r?(this.playNotifSound(),this.viewNotifications(t,i,!0),this.renderWidget(!0)):(this._displayState.widget||this.renderWidget(!1),o>0&&this.playNotifSound()),this._$(".closer").on("click",function(){n._widgetElmsRemoved.push(n._$(this).parent()),n._$(this).parent().remove()}),this._$("#SCWidget .icon img, #SCWidget .chatbox:nth-child(1)").on("click",function(){n.removeWidget(!0),n.viewNotifications(t,i,!0)})},this.clearEventQueue=function(){for(var t=[],i=0;i<this._eventQueue.length;i++)this.triggerPooledEvent(this._eventQueue[i]),t.push(i);for(var e=0;e<t.length;e++)this._eventQueue.splice(t[e],1)},this.clearEventPool=function(t){if(!t||t===!1)return void(this._eventPool=[]);for(var i=0;i<this._eventPool.length;i++)this.triggerPooledEvent(this._eventPool[i].id)},this.triggerPooledEvent=function(t,i){if(t&&!(0>t)){i="object"==typeof i&&i.length>0?i:[];for(var e=0;e<this._eventPool.length;e++)if(this._eventPool[e].id==t)if("timed"==this._eventPool[e].e.EType.toLowerCase())this.timeOut(this._eventPool[e].e.EID,parseFloat(this._eventPool[e].e.TimeOut));else{for(var n=i.length>0?i.join(", "):this.getEventActions(t).join(", "),s=[],o=0;o<this._notificationData.notifications.length;o++)this._notificationData.notifications[o].EID==t&&s.push(this._notificationData.notifications[o]);this.triggerEvent(this._identifiers[this._eventPool[e].e.EIdentifier]+this._eventPool[e].e.EAttrVal,n,this._eventPool[e].e,s)}}},this.startQueuer=function(){if(!this._queueTimeActive){var t=this;this._queueTime=setInterval(function(){t._eventQueue.length>0&&t.clearEventQueue()},1e3),t._queueTimeActive=this._queueTimeActive=!0}},this.stopQueuer=function(){this._queueTimeActive&&(clearInterval(this._queueTime),this._queueTime=null,this._queueTimeActive=!1)},this.poolEvent=function(t){t&&"object"==typeof t&&this._eventPool.push({id:t.EID,e:t})},this.queueEvent=function(t,i){i=!(i===!1),this._eventQueue.push(t),i&&this.startQueuer()},this.getEventActions=function(t){for(var i=[],e=0;e<this._notificationData.actions.length;e++)this._notificationData.actions[e].EID==t&&i.push(this._notificationData.actions[e].EAction);return i.length>0?i:[]},this.getEventCriteria=function(){for(var t=[],i=0;i<this._notificationData.page_event.length;i++)this._notificationData.page_event[i].Criteria&&"undefined"!=typeof this._notificationData.page_event[i].Criteria&&null!=this._notificationData.page_event[i].Criteria&&t.push({eventId:this._notificationData.page_event[i].EID,criteria:JSON.parse(this._notificationData.page_event[i].Criteria)});return t},this.timeOut=function(t,i){if(!t||1>t)return void console.warn("Cannot add time out to event... invalid event id");i&&!isNaN(parseInt(i))&&parseFloat(i)>0||(console.warn("Using default timeOut time of 1 second"),i=1);var e=this;setTimeout(function(){e.handleTimeOutOrCriteria(t)},1e3*parseFloat(i))},this.handleTimeOutOrCriteria=function(t){if(t&&!(1>t)){for(var i=0;i<this._eventPool.length;i++)this._eventPool[i].id==t&&(this._eventPool[i].e.EIdentifier="tag",this._eventPool[i].e.EAttrVal="body",this._eventPool[i].e.EType="UserAction");this._customEvents++;var e="custev"+this._customEvents.toString();this.triggerPooledEvent(t,[e]),this._$("body").trigger(e)}},this.hasInjectedJs=function(t){if(!t||1>t)return!1;for(var i=0;i<this._injectScript.length;i++)if(this._injectScript[i].event==t)return!0;return!1},this.customScript=function(t){for(var i=0;i<this._injectScript.length;i++)this._injectScript[i].event==t&&this._injectScript[i].func()},this.viewNotifications=function(t,i,e){var n=t.EID;this._sidebar.find(".bigchat .header .name").text(this._themeData.sidebar.SBTitle),this._sidebar.find(".bigchat .header .time").text("just now");for(var s,o,a=[],r=[],h=this,d=0;d<i.length;d++){for(var l=d>0?"none":"block",u="ml",c="cb";this._$("#"+u+"0").length>0;)u+="_";for(;this._$("#"+c+"0").length>0;)c+="_";if(i[d].EID==n){a.push(i[d].NID),s=new Date,o=s.getHours()<10?"0"+s.getHours().toString():s.getHours().toString(),o+=":",o+=s.getMinutes()<10?"0"+s.getMinutes().toString():s.getMinutes().toString(),this._sidebar.find(".primarychat").append(this._$("<div></div>").attr("id",u+d.toString()).addClass("message").addClass("left").css("display",l)),this._sidebar.find(".primarychat").append(this._$("<div></div>").addClass("timestamp").text(o).css("display",l)),this._sidebar.find("#"+u+d.toString()).append('<div class="icon"><img src="'+this._themeData.sidebar.SBImg+'" /></div>'),this._sidebar.find("#"+u+d.toString()).append(this._$("<div></div>").attr("id",c+d.toString()).addClass("chatbubble")),i[d].NTitle&&this._sidebar.find("#"+c+d.toString()).append(this._$("<b><p></p></b>").text(i[d].NTitle)),i[d].NMedia&&this._sidebar.find("#"+c+d.toString()).append(i[d].NMedia),i[d].NBody&&this._sidebar.find("#"+c+d.toString()).append(this._$("<p></p>").text(i[d].NBody));for(var g=0;g<i[d].links.length;g++)this._sidebar.find("#"+c+d.toString()).append('<p><a href="'+i[d].links[g]+'" target="_blank">'+i[d].links[g]+"</a></p>");if(d>0&&this._queuedMsgIds.push("#"+u+d.toString()),i[d].HasSeen=!0,i[d].QdEvent.length>0)for(var f=0;f<i[d].QdEvent.length;f++)r.push(i[d].QdEvent[f])}}if(this._queuedMsgIds.length>0&&this.showChatMsgs(),this.notificationSeen(t,a)||(console.warn("Failed to record seen notifications"),console.log(n,a)),a=s=o=void 0,this._displayState.sidebar||this.renderSidebar(e),r.length>0)for(var p=0;p<r.length;p++)this.queueEvent(r[p]);this._$("#ChatClose").on("click",function(){h.removeSidebar(),h.renderWidget(!0),h._$("#SCWidget .notification small").text("0")})},this.showChatMsgs=function(){this._queuedMsgIds.length>0&&this.startNotifInterval()},this.startNotifInterval=function(){if(this._notifTimerActive===!0)return!1;var t=this;this._notifTimer=setInterval(function(){t._$(t._queuedMsgIds[0]).show(),t._$(t._queuedMsgIds[0]).next(".timestamp").show(),t._queuedMsgIds.splice(0,1),t._queuedMsgIds.length<1&&t.killNotifInterval()},1e3*t._notificationTimeout),this._notifTimerActive=!0},this.killNotifInterval=function(){clearInterval(this._notifTimer),this._notifTimerActive=!1},this.renderWidget=function(t){return t=t===!0,this._displayState.widget?!1:(t?this._$("#SCWidget").show():this._$("body").append(this._widget),this._displayState.widget=!0,!0)},this.removeWidget=function(t){if(t=t===!0,!this._displayState.widget)return!1;if(t){var i=this;this._$.each(this._$(".closer"),function(t,e){i._widgetElmsRemoved.push(i._$(e).parent())}),i=void 0,this._$(".closer").parent().remove(),this._$("#SCWidget").hide()}else this._$("#SCWidget").remove();return this._displayState.widget=!1,!0},this.renderSidebar=function(){return this._displayState.sidebar?!1:(this._$("body").append(this._sidebar),this._displayState.sidebar=!0,this._$("title").text(this._defaultPageTitle),this._$("body").append('<script id="tmpScScr">autosize(document.querySelectorAll("textarea"));</script>'),!0)},this.removeSidebar=function(){return this._displayState.sidebar?(this._$("#SCSB").remove(),this._displayState.sidebar=!1,this._$("#tmpScScr").remove(),this._sidebar=this._$('<div id="SCSB" class="sc_main" style="z-index:999;"><div class="bigchat"><div id="ChatClose" class="header"><div class="name"></div><div class="time"></div><div class="close">Close</div></div><div class="primarychat"></div></div></div>'),!0):!1},this.playNotifSound=function(){this._ghostMode||this._playNotificationSound&&("object"==typeof this._audio&&this._audio instanceof Audio?this._audio.play():(console.warn("Notification sound not instance of Audio Object."),console.log("Audio obj:",this._audio)))},this.manualTrigger=function(t){var i,e=this.getCookie(this._eventCookieName);if(!(e&&e.length>0))return!1;i=JSON.parse(e);var n="_"+t.toString()+"_";return i&&i[n]&&"undefined"!=typeof i[n]?!0:!1},this.defaultAjaxSuccCb=function(t){console.log(t)},this.defaultAjaxErrCb=function(){console.error("Ajax failure... contact support or whatever")},this.getParamNames=function(t){var i=/([^\s,]+)/g,e=t.toString().replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,""),n=e.slice(e.indexOf("(")+1,e.indexOf(")")).match(i);return null===n?[]:n},this.validUrl=function(t){t=t.replace(/https\:\/\/|http\:\/\//g,"");var i=/[-a-zA-Z0-9\:\%\.\_\+\~\#\=]{2,256}\.[a-z]{2,10}\b([-a-zA-Z0-9\:\%\_\+\.\~\#\?\&\/\/\=]*)/,e=t.match(i);return null!=e&&e.length>0},this.eventDispatched=function(t){if(t&&t.length>0)for(var i=0;i<this._dispatchedCodes.length;i++)if(t==this._dispatchedCodes[i])return!0;return!1},this.eventTriggered=function(t){if(this._ghostMode)return!0;if(!t||"object"!=typeof t)return!1;if(!t.DispatchCode||t.DispatchCode.length<1)return!1;if(this.getCookie(t.DispatchCode).length>0)return!0;if(this.eventDispatched(t.DispatchCode))return!0;var i=this._$("script[data-dispatch="+t.DispatchCode+"]");if(i.length>0)return!0;var e="?eid="+t.EID+"&dc="+t.DispatchCode;return this._$("head").prepend(this._$('<script type="text/javascript"></script>').attr("src",this._defaultEventTriggeredUri+e).attr("data-dispatch",t.DispatchCode).prop("async",!0)),!0},this.notificationSeen=function(t,i){if(this._ghostMode)return!0;if(!t||!t.EID||!t.DispatchCode||t.DispatchCode<1)return!1;for(var e=0,n=0;n<i.length;n++){if(i[n]<1)return!1;this.notifHasSeen(t.EID,i[n])||(this.setEventNotifCookie(t.EID,i[n]),e++)}if(0==e)return console.log("all notifications have been seen"),!0;var s=i.join("-"),o=t.DispatchCode+"-"+s,a=this._$("script[data-n-dispatch="+o+"]");if(a.length>0)return!0;var r="?eid="+t.EID+"&dc="+t.DispatchCode+"&nids="+s;return this._$("head").prepend(this._$('<script type="text/javascript"></script>').attr("src",this._defaultNotifSeenUri+r).attr("data-n-dispatch",o).prop("async",!0)),!0},this.setCookie=function(t,i,e){if(!this._ghostMode){"undefined"==(typeof e).toLowerCase()&&0!==e&&(e=2);var n=new Date;n.setTime(n.getTime()+24*e*60*60*1e3);var s="expires="+n.toUTCString();document.cookie=t+"="+i+"; "+s+"; domain="+this._siteDomain+"; path=/;"}},this.getCookie=function(t){for(var i=t+"=",e=document.cookie.split(";"),n=0;n<e.length;n++){for(var s=e[n];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(i))return s.substring(i.length,s.length)}return""},this.getDisplatchedCookies=function(){for(var t=[],i=document.cookie.split(";"),e=0;e<i.length;e++){for(var n=i[e];" "==n.charAt(0);)n=n.substring(1);var s=n.split("=");s[1]&&"trig-success"==s[1].trim().toLowerCase()&&t.push(s[0])}return t},this.setEventCookie=function(t){var i=this.getEventCookieObject(t);this.setCookie(this._eventCookieName,JSON.stringify(i),this._defaultCookieExpire)},this.setEventNotifCookie=function(t,i){var e=this.getEventCookieObject(t),n="_"+t.toString()+"_";this.notifHasSeen(t,i)||e[n].push(i),this.setCookie(this._eventCookieName,JSON.stringify(e),this._defaultCookieExpire)},this.notifHasSeen=function(t,i){for(var e=this.getEventCookieObject(t),n="_"+t.toString()+"_",s=!1,o=0;o<e[n].length;o++)e[n][o]==i&&(s=!0);return s},this.getEventCookieObject=function(t){if(1>t)return{};var i="_"+t.toString()+"_",e=this.getCookie(this._eventCookieName),n=e&&e.length>0?JSON.parse(e):{};return n&&n[i]&&"undefined"!=typeof n[i]||(n="object"==typeof n||n instanceof Object?n:{},n[i]=[]),n},this.loadPluginsCallBack=function(){console.log("plugin loaded"),window.SC.initPlugins()},this.loadPlugins=function(){for(var t=0;t<this._loadPlugins.length;t++)try{this.ajax(this._loadPlugins[t],"GET",this.loadPluginsCallBack)}catch(i){console.log(i)}},this.setUpPluginLoad=function(){this._notificationDataCompleteEventListenerSet=!0;var t=this;$(document).on(this._notificationDataCompleteEventName,function(){t.loadPlugins()})},this.pluginLoaded=function(t){for(var i=0;i<this._loadedPlugins.length;i++)if(this._loadedPlugins[i]==t)return!0;return!1},this.initPlugins=function(t){if(t&&"undefined"!=(typeof t).toLowerCase()&&"*"!=t){for(var i=0;i<t.length;i++)for(var e=0;e<this._plugins.length;e++)if(this._plugin[e]._pluginId==t[i]){if(!this.pluginLoaded(t[i])){try{this.hasPluginLoadedEvent(this._plugins[e]._pluginName)||this.addPluginLoadedEvent(this._plugins[e]._pluginName,this.generatePluginLoadedEventName(this._plugins[e]._pluginName)),this._plugins[e].load(this.getPluginLoadedEventName(this._plugins[e]._pluginName)),this._loadedPlugins.push(this._plugins[e]._pluginId)}catch(n){console.log(n)}break}console.info('Tried to reinitialize plugin "'+this._plugins[e]._pluginName+'" ['+this._plugins[e]._pluginId+"]")}}else for(var e=0;e<this._plugins.length;e++)if(this.pluginLoaded(this._plugins[e]._pluginId))console.info('Tried to reinitialize plugin "'+this._plugins[e]._pluginName+'" ['+this._plugins[e]._pluginId+"]");else try{this.hasPluginLoadedEvent(this._plugins[e]._pluginName)||this.addPluginLoadedEvent(this._plugins[e]._pluginName,this.generatePluginLoadedEventName(this._plugins[e]._pluginName)),this._plugins[e].load(this.getPluginLoadedEventName(this._plugins[e]._pluginName)),this._loadedPlugins.push(this._plugins[e]._pluginId)}catch(n){console.log(n)}},this.addPlugin=function(t){return this.validSCPlugin(t)?this.hasPlugin(t)?void console.info("Plugin '"+t._pluginName+"' ["+t._pluginId+"] attempted to load twice."):void this._plugins.push(t):(console.warn("Failed to add invalid plugin:"),void console.log(t))},this.validSCPlugin=function(t){return!!t&&!("undefined"==(typeof t._pluginName).toLowerCase())&&t._pluginName.length>0&&!("undefined"==(typeof t._pluginId).toLowerCase())&&t._pluginId.length&&"function"==(typeof t.load).toLowerCase()},this.reportPluginLoadError=function(t,i){var e='Plugin "%name%" [%id%] is already running. Check out the plugin data to debug why the plugin is loading multiple times';console.warn(e.replace(/\%name\%/g,t).replace(/\%id\%/g,i)),console.info("loadPlugins: ",this._loadPlugins),console.log("plugins: ",this._plugins),console.log("loadedPlugins: ",this._loadedPlugins)},this.hasPlugin=function(t){if(!this.validSCPlugin(t))return!1;for(var i=0;i<this._plugins.length;i++)if(this._plugins[i]._pluginId==t._pluginId)return!0;return!1},this.pluginApply=function(t,i){var e=t.split(".");if(2!=e.length)return void console.log("SC: cannot apply function with params:",t,i);for(var n=e[0],s=e[1],o=!1,a=0;a<this._plugins.length;a++)if(this._plugins[a]._pluginName.toLowerCase()==n.toLowerCase()&&"function"==typeof this._plugins[a][s]){o=!0,this._plugins[a][s].apply(this._plugins[a],i);break}o||console.log("SC: could not find plugin/function",t,i)},this.pluginBind=function(t,i){for(var e=t.split("."),n=e[0],s=!1,o=0;o<this._plugins.length;o++)if(this._plugins[o]._pluginName.toLowerCase()==n.toLowerCase()){s=!0;break}if(s)this.pluginApply(t,i);else{this.hasPluginLoadedEvent(n)||this.addPluginLoadedEvent(n,this.generatePluginLoadedEventName(n));var a=this;$(document).on(this.getPluginLoadedEventName(n),function(){a.pluginApply(t,i)})}},this.hasPluginLoadedEvent=function(t){return t?this._pluginLoadedEvents&&"undefined"!=typeof this._pluginLoadedEvents[t]&&!!this._pluginLoadedEvents:!1},this.addPluginLoadedEvent=function(t,i){t&&i&&(i=i.toLowerCase(),this._pluginLoadedEvents[t]=i)},this.removePluginLoadedEvent=function(t){$(document).off(this._pluginLoadedEvents[t]),delete this._pluginLoadedEvents[t]},this.getPluginLoadedEventName=function(t){return this._pluginLoadedEvents[t]},this.generatePluginLoadedEventName=function(t){return t?this._pluginLoadedEventName+t.toLowerCase()+Math.round(1e3*Math.random()).toString():(console.warn("bad name, foo"),"")},this.reportEventFailure=function(t){console.warn(t)},this.reportNotifSuccess=function(t){console.info("following notification ids viewed and tracked: "+t.toString())},this.reportInvalidLicense=function(t){console.warn("Invalid License Detected. Request Response:"),console.info(t)},this.reportRequestFaulure=function(t){console.warn("Request to SC server failed. Message:"),console.info(t)},this.reportDependencies=function(){console.error("Snake Charmer Relies on jQuery. Please include jQuery library on your web page")}};"undefined"!=typeof jQuery&&jQuery?jQuery(document).ready(function(){("undefined"==typeof window.SC_AUTO_INIT||window.SC_AUTO_INIT!==!1)&&(window.SC=new SnakeCharmer).ini()}):(new SnakeCharmer).reportDependencies();
