/*
 * Plugin for Snake Charmer for Big Commerce
 * @author		Tyler J Barnes
 * @contact		b4rn3scode@gmail.com
 */
"use strict";var SCBCMain=function(){this._version="1.1.1",this._pluginName="SCBCMain",this._pluginId="SC315501",this._storeHash="",this._cart=void 0,this._cartId="SCBCCart",this._cartItemName="SCBCCartItem",this._cartTotal=0,this._products=[],this._eventCriteria=[],this._eventCriteriaMet=[],this._dataAttributes={productId:"prodid",cartCount:"prodqty",productPrice:"prodprice"},this._hasCartProducts=!1,this._hasViewedProducts=!1,this._cookieName="scbcmainet",this._cookieValue=[],this.load=function(t){return window.SC&&"undefined"!=typeof window.SC?(this.getCookieVal(),this.getCriteria(),this.getCart(),this._cart&&"undefined"!=typeof this._cart&&this._cart.length>0&&this.getCartProducts(),t&&($(document).trigger(t),window.SC.removePluginLoadedEvent(this._pluginName)),void(this._products.length>0&&this.checkCriteria())):void console.error("SCBCMain : Cannot find SC... idk how this is even running then.~!?!~.")},this.getCookieVal=function(){var t=window.SC.getCookie(this._cookieName);this._cookieValue=t&&t.length>0?JSON.parse(t):[]},this.getCart=function(){var t=$("#"+this._cartId);return t.length<1?void console.error("SCBCMain : cannot find cart"):void(this._cart=t)},this.calculateCartTotal=function(){for(var t=0,i=0;i<this._products.length;i++)this._products[i].productPrice&&"undefined"!=typeof this._products[i].productPrice&&this._products[i].productPrice>0&&(t+=this._products[i].productPrice);this._cartTotal=t},this.addProduct=function(t,i,e,r){if(t&&"undefined"!=typeof t&&!(1>t))if(i=i&&i>0?i:0,e=e&&e>0?e:0,r=r===!0,this.hasProduct(t)){var o={};i>0&&(o.cartCount=i),e>0&&(o.productPrice=e),o.viewed=r,this.updateProduct(t,o)}else this._products.push({id:t,cartCount:i,productPrice:e,viewed:r})},this.hasProduct=function(t){if(!t||"undefined"==typeof t||1>t)return!1;for(var i=0;i<this._products.length;i++)if(this._products[i].id==t)return!0;return!1},this.updateProduct=function(t,i){if(t&&"undefined"!=typeof t&&!(1>t)){var e=!1;for(var r in i){e=!0;break}if(e){this.hasProduct(t)||this.addProduct(t,0,0,!1);for(var o=0;o<this._products.length;o++)if(this._products[o].id==t){for(var n in i)n in this._products[o]&&(this._products[o][n]=i[n]);break}}}},this.getCriteria=function(){return"undefined"==typeof window.SC.getEventCriteria?void console.error("SCBCMain : Cannot get criteria cuz SC function doesnt exist.... this msg if for testing but im leaving it in anyway"):void(this._eventCriteria=window.SC.getEventCriteria())},this.getCartProducts=function(){var t=this._cart.find("*[data-name="+this._cartItemName+"]");if(t.length>0){this._hasCartProducts=!0;for(var i=0;i<t.length;i++)this.addProduct(parseInt($(t[i]).data(this._dataAttributes.productId)),parseInt($(t[i]).data(this._dataAttributes.cartCount)),parseFloat($(t[i]).data(this._dataAttributes.productPrice).replace(/[^0-9|\.]/g,"")))}this._hasCartProducts&&this.calculateCartTotal()},this.productViewed=function(t){return!t||"undefined"==typeof t||isNaN(parseInt(t))?void console.log("SCBCMain : cannot mark product as viewed ["+t+"]"):(this.addProduct(t,0,0,!0),void(this._hasViewedProducts=!0))},this.checkCriteria=function(){this._eventCriteriaMet=[];for(var t=0;t<this._eventCriteria.length;t++)for(var i=this._eventCriteria[t],e=0,r=0;r<i.criteria.length;r++){i.criteria[r].cartTotal&&"undefined"!=typeof i.criteria[r].cartTotal&&i.criteria[r].cartTotal>0&&this._cartTotal>=i.criteria[r].cartTotal&&this._eventCriteriaMet.push(i.eventId);for(var o=0;o<this._products.length;o++){var n=this._products[o];n.id==i.criteria[r].productId&&(i.criteria[r].viewed&&"undefined"!=typeof i.criteria[r].viewed&&1==i.criteria[r].viewed&&1==n.viewed&&this._eventCriteriaMet.push(i.eventId),i.criteria[r].cartCount&&"undefined"!=typeof i.criteria[r].cartCount&&i.criteria[r].cartCount>0&&n.cartCount>=i.criteria[r].cartCount&&(e++,e>=i.criteria.length&&this._eventCriteriaMet.push(i.eventId)))}}this._eventCriteriaMet.length>0&&this.triggerEvents()},this.triggerEvents=function(){window.SC._playNotificationSound=!1;for(var t=!1,i=0;i<this._eventCriteriaMet.length;i++)this.inCookieArray(this._eventCriteriaMet[i])||(window.SC._playNotificationSound=!0,t=!0),window.SC.handleTimeOutOrCriteria(this._eventCriteriaMet[i]);t&&$(".chatbox").click(),this.updateCookie()},this.inCookieArray=function(t){for(var i=0;i<this._cookieValue.length;i++)if(this._cookieValue[i]==t)return!0;return!1},this.updateCookie=function(){for(var t=!1,i=0;i<this._eventCriteriaMet.length;i++)this.inCookieArray(this._eventCriteriaMet[i])||(this._cookieValue.push(this._eventCriteriaMet[i]),t=!0);t&&window.SC.setCookie(this._cookieName,JSON.stringify(this._cookieValue),30)},this.promoConvert=function(t){var i=[],e=!t||"undefined"==typeof t||1>t?"other":this.getPromoType(t);e&&e.length>0&&i.push({promoType:e}),window.SC.pluginBind("SCTracker.updateCookie",[t,{converted:!0,promoType:e}]),window.SC.pluginBind("SCTracker.setUpConvert",[!1,0,i])},this.getPromoType=function(t){for(var i=0;i<this._eventCriteria.length;i++)if(this._eventCriteria[i].eventId==t)return this._eventCriteria[i].promoType;return""},this.promoClick=function(t){if(t.length<1&&this.promoConvert(-1),t.length>1){var i=this;$.each(t,function(t,e){var r=$(e).data("evid");i.promoConvert(r)})}else{var e=$(t[0]).data("evid");this.promoConvert(e)}}};window.SC.addPlugin(new SCBCMain);
